<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="com.myedumyselect.personal.dao.PersonalLikeDAO">

	<!-- AdvertiseVO 별칭 일괄 부여 -->
	<resultMap type="advertiseBoard" id="advertiseBoardMap">
		<id column="common_no" property="commonNo" />
		<result column="academy_id" property="academyId" />
		<result column="member_type_id" property="memberTypeId" />
		<result column="common_nickname" property="commonNickname" />
		<result column="common_title" property="commonTitle" />
		<result column="common_content" property="commonContent" />
		<result column="common_register_date"
			property="commonRegisterDate" />
		<result column="common_edit" property="commonEdit" />
		<result column="common_readcnt" property="commonReadcnt" />
		<result column="common_block_confirm"
			property="commonBlockConfirm" />
		<result column="common_block_date" property="commonBlockDate" />
		<result column="common_thumb" property="commonThumb" />
		<result column="common_file" property="commonFile" />
	</resultMap>

	<!-- LikeVO 별칭 일괄 부여 -->
	<resultMap type="like" id="likeMap">
		<id column="common_no" property="commonNo" />
		<result column="like_member_id" property="likePropertyId" />
		<result column="like_check" property="likeCheck" />
		<result column="like_id" property="likeId" />
	</resultMap>

	<!-- personal -->
	<resultMap type="personalLogin" id="personalLoginMap">
		<id column="personal_id" property="personalId" />
		<result column="member_type_id" property="memberTypeId" />
		<result column="personal_name" property="personalName" />
		<result column="personal_email" property="personalEmail" />
		<result column="personal_passwd" property="personalPasswd" />
		<result column="personal_birth" property="personalBirth" />
		<result column="personal_address" property="personalAddress" />
		<result column="personal_phone" property="personalPhone" />
		<result column="personal_join_date" property="personalJoinDate" />
		<result column="personal_login_fail_count"
			property="personalLoginFailCount" />
		<result column="personal_account_banned_date"
			property="personalAccountBannedDate" />
		<result column="personal_passwd_change_date"
			property="personalPasswdChangeDate" />
	</resultMap>

	<!-- 좋아요 등록 -->
	<insert id="insertLike" parameterType="like">
		INSERT
		INTO tb_like (common_no, like_member_id, like_check, like_id)
		VALUES (
		#{commonNo}, #{likeMemberId}, 1, like_seq.nextval )
	</insert>


	<!-- 좋아요 변경 -->
	<update id="toggleLike" parameterType="like">
		UPDATE tb_like
		SET like_check = CASE
		WHEN like_check = 0 THEN 1
		WHEN like_check = 1 THEN 2
		WHEN like_check = 2 THEN 1
		END
		WHERE common_no = #{commonNo}
		AND like_member_id = #{likeMemberId}
	</update>


	<!-- 좋아요 개수 <select id="getLikeCount" parameterType="int" resultType="int"> 
		SELECT COUNT ( NVL(like_check, 0) ) FROM tb_like WHERE common_no = #{common_no} 
		AND like_check = 1 </select> -->


	<!-- 좋아요 여부 확인 -->
	<select id="getLike" parameterType="like"
		resultType="java.lang.Integer">
		SELECT like_check
		FROM tb_like
		WHERE common_no = #{commonNo}
		AND like_member_id = #{likeMemberId}
	</select>


	<!-- 1. 좋아요 테이블에서 본인이 좋아요 누른 게시물의 번호를 가져온다. -->
	<select id="getLikedCommonNos" parameterType="personalLogin"
		resultType="java.lang.Integer">
		SELECT common_no
		FROM tb_like
		WHERE like_member_id = #{personalId} AND like_check = 1
	</select>

	<!-- 2. 반환 받은 게시물 번호들을 가지고 게시물 테이블에 가서 모든 내용을 조회한다. -->
	<select id="getCommonBoardByNo"
		parameterType="java.lang.Integer" resultMap="advertiseBoardMap">
		SELECT *
		FROM TB_COMMON_BOARD
		WHERE COMMON_NO = #{commonNo}
	</select>

	<select id="likeList" parameterType="like" resultMap="likeMap">
		SELECT *
		FROM tb_like
		WHERE like_member_id = #{likeMemberId}
	</select>




</mapper>