<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.myedumyselect.commonboard.free.dao.FreeDAO">

<resultMap type="freeBoard" id="freeBoardMap">
    <id column="common_no" property="commonNo" />
    <result column="personal_id" property="personalId" />
    <result column="member_type_id" property="memberTypeId" />
    <result column="common_title" property="commonTitle" />
    <result column="common_content" property="commonContent" />
    <result column="common_register_date" property="commonRegisterDate" />
    <result column="common_edit" property="commonEdit" />
    <result column="common_readcnt" property="commonReadcnt" /> 
</resultMap>

<select id="freeList" parameterType="freeBoard" resultMap="freeBoardMap">
    SELECT common_no, personal_id, member_type_id, common_title, common_content, 
    to_char(common_register_date,'YYYY-MM-DD') as common_register_date, 
    to_char(common_edit, 'YYYY-MM-DD') as common_edit, 
    common_readcnt 
    FROM tb_common_board
    <where>
        <include refid="freeSearch"></include>
    </where>
    ORDER BY common_no desc
</select>




	<!-- <insert id="freeInsert" parameterType="freeBoard"> INSERT INTO tb_common_board(commonNo, 
		personalId, memberTypeId, commonTitle, commonContent) VALUES (free_board_seq.nextval, 
		#{personalId}, #{memberTypeId}, #{commonTitle}, #{commonContent}) </insert> -->

	<insert id="freeInsert" parameterType="freeBoard">
		<selectKey keyProperty="commonNo" resultType="int" order="BEFORE">
			select free_board_seq.nextval from dual
		</selectKey>

		INSERT INTO tb_common_board(common_no, personal_id, member_type_id,
		common_title, common_content)
		VALUES (#{commonNo}, #{personalId},	#{memberTypeId}, #{commonTitle}, #{commonContent})
	</insert>

	<update id="readCntUpdate" parameterType="freeBoard">
		update tb_common_board
		set common_readcnt = common_readcnt + 1
		where common_no = #{commonNo}
	</update>


	<select id="freeDetail" parameterType="freeBoard" resultMap="freeBoardMap">
		SELECT common_no, personal_id, member_type_id,
		common_title, common_content, TO_CHAR(common_register_date,'YYYY-MM-DD
		HH24:MI:SS') AS common_register_date, common_readcnt
		FROM
		tb_common_board
		WHERE common_no = #{commonNo}
	</select>


	<update id="freeUpdate" parameterType="freeBoard">
        UPDATE tb_common_board
        SET common_title = #{commonTitle},
        common_content = #{commonContent},
        common_register_date = sysdate
        WHERE common_no = #{commonNo}
    </update>



	<delete id="freeDelete" parameterType="freeBoard">
		DELETE FROM
		tb_common_board where common_no = #{commonNo}
	</delete>


	<sql id="freeSearch">
		<if test="search=='common_title'">
				<![CDATA[ common_title LIKE '%' || #{keyword} ||'%' ]]>
		</if>
		<if test="search=='common_content'">
				<![CDATA[ common_content LIKE '%' || #{keyword} ||'%' ]]>
		</if>
		<if test="search=='personal_id'">
				<![CDATA[ personal_id LIKE '%' || #{keyword} ||'%' ]]>
		</if>
	</sql>

	<select id="freeListCnt" parameterType="freeBoard" resultType="int">
		SELECT count(*) FROM tb_common_board
		<trim prefix=" where (" suffix=")">
			<include refid="freeSearch"></include>
		</trim>
	</select>

	

</mapper>